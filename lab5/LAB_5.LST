Turbo Assembler	 Version 4.1	    10/09/25 20:23:29	    Page 1
lab_5.asm



      1					 ; Директива для использования	команд процессора   +
      2					 80386
      3					 .386
      4
      5					 ; Определение сегмента кода для COM-файла
      6	    0000			 CSEG SEGMENT PARA USE16 'CODE'
      7					     ASSUME CS:CSEG, DS:CSEG, ES:CSEG
      8
      9					     ORG 100h
     10
     11					 ; --- Основная	программа (для вызова	и теста) ---
     12	    0100			 start:
     13					     ; 1. Готовим параметры для вызова	подпрограммы
     14	    0100  8C C8			     MOV AX, CS
     15	    0102  8E C0			     MOV ES, AX
     16	    0104  BA 0110r		     LEA DX, BIT_STRING	 ; Загружаем в DX адрес нашей битовой    +
     17					 строки
     18
     19	    0107  B9 0010 90		     MOV CX, BIT_LENGTH	 ; Длина строки в битах
     20
     21					     ; 2. Вызываем подпрограмму
     22	    010B  E8 0004		     CALL REVERSE_BITS
     23
     24					     ; 3. Завершаем программу
     25	    010E  CD 20			     INT 20h
     26
     27					 ; --- Данные для тестирования ---
     28	    0110  B1 95			 BIT_STRING  DB	0B1h, 95h    ; Тестовая	строка: 10110001 10010101b (16 бит)
     29		  =0010			 BIT_LENGTH  EQU 16	     ; Длина строки в битах
     30
     31					 ; =========================================================================
     32					 ; ПОДПРОГРАММА: REVERSE_BITS (ОПТИМИЗИРОВАННЫЙ ВАРИАНТ)
     33					 ; Назначение: Переворачивает битовую строку	    +
     34					 "задом наперёд".
     35					 ; Вход:	   ES:DX - адрес строки, CX - длина в битах.
     36					 ; =========================================================================
     37	    0112			 REVERSE_BITS PROC NEAR
     38	    0112  51			     PUSH CX
     39	    0113  56			     PUSH SI
     40	    0114  57			     PUSH DI
     41	    0115  53			     PUSH BX
     42	    0116  50			     PUSH AX		 ; Сохраняем AX, т.к. будем использовать+
     43					 AL/AH
     44
     45	    0117  8B DA			     MOV BX, DX		 ; Используем	BX для корректной		    +
     46					 адресации
     47	    0119  33 F6			     XOR SI, SI		 ; Индекс	первого бита
     48	    011B  8B F9			     MOV DI, CX
     49	    011D  4F			     DEC DI		 ; Индекс	последнего бита
     50
     51	    011E  D1 E9			     SHR CX, 1		 ; Количество	пар для обмена
     52	    0120  76 24	90 90		     JBE done_reversing	 ; Выход, если	длина < 2
     53
     54	    0124			 swap_loop:
     55					     ; Эффективный алгоритм:	инвертируем биты,	    +
     56					 только если они не равны.
     57
Turbo Assembler	 Version 4.1	    10/09/25 20:23:29	    Page 2
lab_5.asm



     58					     ; 1. Помещаем оба бита в регистр для сравнения,	не+
     59					 используя стек.
     60	    0124  B0 00			     MOV AL, 0
     61	    0126  26: 0F A3 37		     BT	 ES:[BX], SI	 ; Тестируем первый бит, результат в CF
     62	    012A  D0 D0			     RCL AL, 1		 ; Перемещаем	бит из CF в AL (теперь AL =	    +
     63					 0000000_start_bit)
     64
     65	    012C  B4 00			     MOV AH, 0
     66	    012E  26: 0F A3 3F		     BT	 ES:[BX], DI	 ; Тестируем второй бит, результат в CF
     67	    0132  D0 D4			     RCL AH, 1		 ; Перемещаем	бит из CF в AH (теперь AH =	    +
     68					 0000000_end_bit)
     69
     70					     ; 2. Сравниваем биты.
     71	    0134  3A C4			     CMP AL, AH
     72	    0136  74 0A	90 90		     JE	 no_swap_needed	 ; Если биты равны, ничего не делаем,    +
     73					 переходим к следующей итерации.
     74
     75					     ; 3. Если биты разные - инвертируем оба.
     76					     ; Команда BTC (Bit Test and	Complement) идеально подходит для+
     77					 этого.
     78	    013A  26: 0F BB 37		     BTC ES:[BX], SI
     79	    013E  26: 0F BB 3F		     BTC ES:[BX], DI
     80
     81	    0142			 no_swap_needed:
     82					     ; 4. Сдвигаем указатели и переходим к следующей   +
     83					 итерации.
     84	    0142  46			     INC SI
     85	    0143  4F			     DEC DI
     86	    0144  E2 DE			     LOOP swap_loop
     87
     88	    0146			 done_reversing:
     89	    0146  58			     POP AX
     90	    0147  5B			     POP BX
     91	    0148  5F			     POP DI
     92	    0149  5E			     POP SI
     93	    014A  59			     POP CX
     94	    014B  C3			     RET
     95	    014C			 REVERSE_BITS ENDP
     96					 ; =========================================================================
     97
     98	    014C			 CSEG ENDS
     99					 END start
Turbo Assembler	 Version 4.1	    10/09/25 20:23:29	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "10/09/25"
??FILENAME			  Text	 "lab_5	  "
??TIME				  Text	 "20:23:29"
??VERSION			  Number 040A
@CPU				  Text	 0F0FH
@CURSEG				  Text	 CSEG
@FILENAME			  Text	 LAB_5
@WORDSIZE			  Text	 2
BIT_LENGTH			  Number 0010
BIT_STRING			  Byte	 CSEG:0110
DONE_REVERSING			  Near	 CSEG:0146
NO_SWAP_NEEDED			  Near	 CSEG:0142
REVERSE_BITS			  Near	 CSEG:0112
START				  Near	 CSEG:0100
SWAP_LOOP			  Near	 CSEG:0124

Groups & Segments		  Bit Size Align  Combine Class

CSEG				  16  014C Para	  none	  CODE
