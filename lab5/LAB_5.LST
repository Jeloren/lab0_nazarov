Turbo Assembler	 Version 4.1	    10/24/25 09:02:45	    Page 1
lab_5.asm



      1					 .386
      2	    0000			 CSEG	 SEGMENT PARA USE16 'CODE'
      3					     ASSUME  CS:CSEG,DS:CSEG,SS:CSEG
      4					     ORG     100h
      5
      6	    0100			 start:
      7					     ; Инициализация сегментов
      8	    0100  8C C8			     MOV     AX, CS
      9	    0102  8E D8			     MOV     DS, AX
     10	    0104  8E C0			     MOV     ES, AX
     11	    0106  8E E0			     MOV     FS, AX
     12
     13					     ; Подготовка параметров для	процедуры
     14	    0108  BB 0180r		     MOV     BX, OFFSET	SOURCE_STR   ; DS:BX - адрес исходной строки
     15	    010B  BA 0182r		     MOV     DX, OFFSET	RESULT_STR   ; FS:DX - адрес результирующей	    +
     16					 строки
     17	    010E  B9 0005		     MOV     CX, 5		     ; Длина в битах
     18
     19	    0111  E8 0005		     CALL    BIT_EXPAND_PROC
     20
     21					     ; Завершение программы
     22	    0114  B8 4C00		     MOV     AX, 4C00h
     23	    0117  CD 21			     INT     21h
     24
     25					 ; ---------------------------------------------------------------
     26					 ; Вход:
     27					 ;   DS:BX - исходная строка
     28					 ;   FS:DX - результирующая строка
     29					 ;   CX	   - длина	в битах [cite: 260]
     30					 ; ---------------------------------------------------------------
     31	    0119			 BIT_EXPAND_PROC PROC
     32	    0119  50			     PUSH    AX
     33	    011A  53			     PUSH    BX
     34	    011B  51			     PUSH    CX
     35	    011C  52			     PUSH    DX
     36	    011D  56			     PUSH    SI
     37	    011E  57			     PUSH    DI
     38	    011F  55			     PUSH    BP		     ; Сохраняем BP, т.к. используем его    +
     39					 для	счетчика
     40
     41	    0120  8B F3			     MOV     SI, BX	     ; источник: DS:SI
     42	    0122  8B FA			     MOV     DI, DX	     ; приёмник: FS:DI
     43
     44	    0124  32 DB			     XOR     BL, BL	     ; BL = текущий байт результата
     45	    0126  33 ED			     XOR     BP, BP	     ; BP = счётчик бита источника (0..7)
     46	    0128  B6 00			     MOV     DH, 0	     ; DH = счётчик бита приёмника (0..7)
     47
     48	    012A  8A 04			     MOV     AL, [SI]	     ; Загружаем первый байт	источника
     49	    012C  32 E4			     XOR     AH, AH	     ; Очищаем AH, т.к. BT работает с	AX
     50
     51	    012E			 EXPAND_LOOP:
     52	    012E  0B C9			     OR	     CX, CX
     53	    0130  74 3C	90 90		     JZ	     WRITE_LAST	     ; Если	CX=0, биты кончились, выходим
     54
     55					     ; --- Извлекаем бит номер	BP из	AX с помощью BT	---
     56					     ; Мы используем: BT AX, BP
     57					     ; AX (r/m16) содержит байт (в	AL)
Turbo Assembler	 Version 4.1	    10/24/25 09:02:45	    Page 2
lab_5.asm



     58					     ; BP (r16)	содержит номер бита (0-7)
     59	    0134  0F A3	E8		     BT	     AX, BP
     60
     61					     ; --- Преобразуем: 0 ->	01 (1),	1 -> 10	(2) ---
     62	    0137  72 07	90 90		     JC	     SET_10	     ; Если	CF=1 (бит был 1),	идем ставить	2   +
     63					 (10b)
     64	    013B  B4 01			     MOV     AH, 1	     ; CF=0 (бит был 0). AH = 1 (01b)
     65	    013D  EB 03	90		     JMP     INSERT
     66	    0140			 SET_10:
     67	    0140  B4 02			     MOV     AH, 2	     ; CF=1 (бит был 1). AH = 2 (10b)
     68
     69	    0142			 INSERT:
     70					     ; --- Вставляем AH (2 бита: 01b или 10b) в BL на позицию	DH  +
     71					 ---
     72	    0142  51			     PUSH    CX		     ; Сохраняем CX, так как CL нужен для SHL
     73	    0143  8A CE			     MOV     CL, DH
     74	    0145  D2 E4			     SHL     AH, CL	     ; Сдвигаем	2 бита (01 или 10) на нужную +
     75					 позицию
     76	    0147  59			     POP     CX		     ; Восстанавливаем CX
     77	    0148  0A DC			     OR	     BL, AH	     ; Вставляем биты в байт-аккумулятор
     78
     79					     ; --- Обновляем счётчики ---
     80	    014A  45			     INC     BP		     ; Следующий бит источника
     81	    014B  83 FD	08		     CMP     BP, 8
     82	    014E  0F 82	FEAE		     JB	     NO_SRC_NEXT
**Error** lab_5.asm(77)	Undefined symbol: NO_SRC_NEXT
     83					     ; Нужен следующий байт источника
     84	    0152  46			     INC     SI
     85	    0153  8A 04			     MOV     AL, [SI]	     ; Загружаем следующий байт
     86	    0155  32 E4			     XOR     AH, AH	     ; Снова очищаем AH
     87	    0157  33 ED			     XOR     BP, BP	     ; Сбрасываем счётчик битов		    +
     88					 источника NO_SRC_NEXT:
     89
     90	    0159  80 C6	02		     ADD     DH, 2	     ; Мы вставили 2 бита
     91	    015C  80 FE	08		     CMP     DH, 8
     92	    015F  72 0A	90 90		     JB	     NO_DST_WRITE
     93					     ; Байт	приёмника (BL)	заполнен, записываем его
     94	    0163  64: 88 1D		     MOV     FS:[DI], BL
     95	    0166  47			     INC     DI
     96	    0167  32 DB			     XOR     BL, BL	     ; Очищаем аккумулятор результата
     97	    0169  32 F6			     XOR     DH, DH	     ; Сбрасываем счётчик битов		    +
     98					 приёмника
     99	    016B			 NO_DST_WRITE:
    100
    101	    016B  49			     DEC     CX		     ; Уменьшаем счетчик обработанных   +
    102					 бит
    103	    016C  EB C0			     JMP     EXPAND_LOOP
    104
    105	    016E			 WRITE_LAST:
    106					     ; Записываем последний неполный	байт, если он	    +
    107					 есть
    108	    016E  80 FE	00		     CMP     DH, 0
    109	    0171  74 05	90 90		     JE	     DONE
    110	    0175  64: 88 1D		     MOV     FS:[DI], BL     ; Записываем остаток
    111
    112	    0178			 DONE:
    113	    0178  5D			     POP     BP		     ; Восстанавливаем BP
Turbo Assembler	 Version 4.1	    10/24/25 09:02:45	    Page 3
lab_5.asm



    114	    0179  5F			     POP     DI
    115	    017A  5E			     POP     SI
    116	    017B  5A			     POP     DX
    117	    017C  59			     POP     CX
    118	    017D  5B			     POP     BX
    119	    017E  58			     POP     AX
    120	    017F  C3			     RET
    121	    0180			 BIT_EXPAND_PROC ENDP
    122
    123					 ; -----------------------------
    124					 ; Данные
    125					 ; -----------------------------
    126	    0180  15 00			 SOURCE_STR  DB	 15h, 0	     ; 00010101b.
    127	    0182  03*(00)		 RESULT_STR  DB	 3 DUP(0)    ; Буфер для результата (5 бит	-> 10 бит+
    128					 -> 2 байта)
    129								     ; 3 байта - с запасом
    130
    131	    0185			 CSEG	 ENDS
    132					 END start
Turbo Assembler	 Version 4.1	    10/24/25 09:02:45	    Page 4
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "10/24/25"
??FILENAME			  Text	 "lab_5	  "
??TIME				  Text	 "09:02:45"
??VERSION			  Number 040A
@CPU				  Text	 0F0FH
@CURSEG				  Text	 CSEG
@FILENAME			  Text	 LAB_5
@WORDSIZE			  Text	 2
BIT_EXPAND_PROC			  Near	 CSEG:0119
DONE				  Near	 CSEG:0178
EXPAND_LOOP			  Near	 CSEG:012E
INSERT				  Near	 CSEG:0142
NO_DST_WRITE			  Near	 CSEG:016B
RESULT_STR			  Byte	 CSEG:0182
SET_10				  Near	 CSEG:0140
SOURCE_STR			  Byte	 CSEG:0180
START				  Near	 CSEG:0100
WRITE_LAST			  Near	 CSEG:016E

Groups & Segments		  Bit Size Align  Combine Class

CSEG				  16  0185 Para	  none	  CODE
Turbo Assembler	 Version 4.1	    10/24/25 09:02:45	    Page 5
Error Summary



**Error** lab_5.asm(77)	Undefined symbol: NO_SRC_NEXT
